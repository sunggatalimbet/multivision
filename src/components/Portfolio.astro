---
import { Image } from "astro:assets";
import Title from "./Title.astro";
import Subtitle from "./Subtitle.astro";
import Table from "./Table.astro";
import porfolio1 from "../assets/portfolio-1.png";
import porfolio2 from "../assets/portfolio-2.png";
---
<div class="max-w-[1440px] mx-auto flex flex-col gap-8 sm:gap-16 px-[10px] lg:px-12 py-[56px] lg:py-[34px]">
    
</section>

<script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    const toggleTable1 = document.getElementById('toggleTable1');
    const toggleTable2 = document.getElementById('toggleTable2');
    const tableContent1 = document.getElementById('tableContent1');
    const tableContent2 = document.getElementById('tableContent2');
    const arrowIcon1 = toggleTable1?.querySelector('svg');

        const productItems = document.querySelectorAll('.portfolio-item');
        
        productItems.forEach((item, index) => {
            gsap.fromTo(item, 
                {
                    opacity: 0,
                    y: 50,
                    scale: 0.9 
                },
                {
                    opacity: 1,
                    y: 0, 
                    scale: 1,
                    duration: 0.5,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: item,
                        start: 'top 80%', // When top of element hits 80% of viewport
                        once: true, // Animation runs only once
                    }
                }
            );
        });

    function setupTableToggle(toggleButton: HTMLElement | null, tableContent: HTMLElement | null, arrowIcon: SVGSVGElement | null | undefined) {
        if (!toggleButton || !tableContent || !arrowIcon) return;

        // Initially hide the table
        gsap.set(tableContent, { 
            height: 0, 
            opacity: 0, 
            overflow: 'hidden' 
        });

        toggleButton.addEventListener('click', () => {
            const isHidden = tableContent.classList.contains('h-0');

            // Toggle rotate animation for arrow
            gsap.to(arrowIcon, {
                rotation: isHidden ? 180 : 0,
                duration: 0.1,
                ease: 'power2.inOut'
            });

            // Animate table height and opacity
            if (isHidden) {
                gsap.to(tableContent, {
                    height: 'auto',
                    opacity: 1,
                    duration: 0.2,
                    ease: 'power2.out',
                    onComplete: () => {
                        tableContent.classList.remove('h-0');
                    }
                });
            } else {
                gsap.to(tableContent, {
                    height: 0,
                    opacity: 0,
                    duration: 0.2,
                    ease: 'power2.in',
                    onComplete: () => {
                        tableContent.classList.add('h-0');
                    }
                });
            }
        });
    }

    // Setup for first table
    setupTableToggle(toggleTable1, tableContent1, arrowIcon1);

    // Setup for second table
    setupTableToggle(
        toggleTable2, 
        tableContent2, 
        toggleTable2?.querySelector('svg')
    );
</script>